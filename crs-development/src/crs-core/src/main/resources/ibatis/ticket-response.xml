<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
        "sql-map-2.dtd">

<sqlMap namespace="ticket-response">

    <typeAlias alias="TicketResponse"
        type="pl.nask.crs.ticket.response.TicketResponse" />
    <resultMap id="ticketResponseMapping" class="TicketResponse">
        <result property="id" column="id" />
        <result property="title" column="title"
            typeHandler="pl.nask.crs.commons.dao.ibatis.handlers.StringHandler" />
        <result property="text" column="text"
            typeHandler="pl.nask.crs.commons.dao.ibatis.handlers.StringHandler" />
    </resultMap>

    <sql id="select-all-from">
        SELECT
        Response_ID as id,
        Response_Title as title,
        Response_Text as text
        FROM
        TicketResponse
    </sql>

    <select id="getTicketResponse" parameterClass="long"
        resultMap="ticketResponseMapping">
        <include refid="ticket-response.select-all-from" />
        WHERE
        Response_ID=#id#
    </select>

    <select id="getTicketResponseByTitle" parameterClass="string"
        resultMap="ticketResponseMapping">
        <include refid="ticket-response.select-all-from" />
        WHERE
        Response_Title=#title,handler=pl.nask.crs.commons.dao.ibatis.handlers.StringHandler#
        LIMIT 1
    </select>

    <select id="getTicketResponseList" parameterClass="java.util.Map"
        resultMap="ticketResponseMapping">
        <include refid="ticket-response.select-all-from" />
        ORDER BY
        Response_Title ASC
    </select>

    <select id="getLockedTicketResponse" parameterClass="long"
        resultMap="ticketResponseMapping">
        <include refid="ticket-response.select-all-from" />
        WHERE
        Response_ID=#id#
        FOR UPDATE
    </select>

    <select id="findTicketResponse" resultMap="ticketResponseMapping">

        <include refid="ticket-response.select-all-from" />
        ORDER BY
        Response_Title ASC
    </select>

    <insert id="createTicketResponse" parameterClass="TicketResponse">
        INSERT INTO
        TicketResponse
        VALUES
        (NULL,
        #title,handler=pl.nask.crs.commons.dao.ibatis.handlers.StringHandler#,
        #text,handler=pl.nask.crs.commons.dao.ibatis.handlers.StringHandler#)

        <selectKey type="post" keyProperty="id" resultClass="int">
            SELECT
            LAST_INSERT_ID() AS id
        </selectKey>
    </insert>

    <update id="updateTicketResponseText" parameterClass="TicketResponse">
        UPDATE
        TicketResponse
        SET
        Response_Text=#text,handler=pl.nask.crs.commons.dao.ibatis.handlers.StringHandler#
        WHERE
        Response_ID=#id#
    </update>

    <delete id="deleteTicketResponse" parameterClass="long">
        DELETE FROM
        TicketResponse
        WHERE
        Response_ID=#id#
    </delete>
</sqlMap>
