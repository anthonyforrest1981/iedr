<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
        PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
        "sql-map-2.dtd">

<sqlMap namespace="dsm-test">

    <select id="getAllActions" resultClass="java.lang.String">
        select Action_Name
        from DSM_Action;
    </select>

    <select id="getAllEvents" resultClass="java.lang.String">
        select Name
        from
        DSM_Event;
    </select>

    <select id="getAllNRPStatuses" resultClass="java.lang.String">
        select DISTINCT
        NRP_Status from DSM_State;
    </select>

    <select id="getAllHolderTypes" resultClass="java.lang.String">
        select DISTINCT
        D_Holder_Type from DSM_State;
    </select>

    <select id="getAllCustTypes" resultClass="java.lang.String">
        select DISTINCT
        Cust_Type from DSM_State;
    </select>

    <select id="getAllRenewalModes" resultClass="java.lang.String">
        select DISTINCT
        Renewal_Mode from DSM_State;
    </select>

    <sql id="dsmCriteria">
        <dynamic prepend="where">
            <isNotEmpty prepend="and" property="criteria.id">
                DSM.State = #criteria.id#
            </isNotEmpty>
            <isNotEmpty prepend="and" property="criteria.holderTypes">
                DSM.D_Holder_Type IN
                <iterate property="criteria.holderTypes" open="("
                         close=")" conjunction=",">
                    #criteria.holderTypes[],handler=pl.nask.crs.domains.dao.ibatis.handlers.HolderTypeHandler#
                </iterate>
            </isNotEmpty>
            <isNotEmpty prepend="and" property="criteria.renewalModes">
                DSM.Renewal_Mode IN
                <iterate property="criteria.renewalModes" open="("
                         close=")" conjunction=",">
                    #criteria.renewalModes[],handler=pl.nask.crs.domains.dao.ibatis.handlers.RenewalModeHandler#
                </iterate>
            </isNotEmpty>
            <isNotEmpty prepend="and" property="criteria.locked">
                DSM.Locked = #criteria.locked,handler=pl.nask.crs.commons.dao.ibatis.handlers.NullableCharToBooleanHandler#
            </isNotEmpty>
            <isNotEmpty prepend="and" property="criteria.customerTypes">
                DSM.Cust_Type IN
                <iterate property="criteria.customerTypes" open="("
                         close=")" conjunction=",">
                    #criteria.customerTypes[],handler=pl.nask.crs.domains.dao.ibatis.handlers.CustomerTypeHandler#
                </iterate>
            </isNotEmpty>
            <isNotEmpty prepend="and" property="criteria.nrpStatuses">
                DSM.NRP_Status IN
                <iterate property="criteria.nrpStatuses" open="("
                         close=")" conjunction=",">
                    #criteria.nrpStatuses[],handler=pl.nask.crs.domains.dao.ibatis.handlers.NrpStatusHandler#
                </iterate>
            </isNotEmpty>
            <isNotEmpty prepend="and" property="criteria.secondaryMarketStatuses">
                DSM.Secondary_Market_Status IN
                <iterate property="criteria.secondaryMarketStatuses" open="("
                         close=")" conjunction=",">
                    #criteria.secondaryMarketStatuses[],handler=pl.nask.crs.domains.dao.ibatis.handlers.SecondaryMarketStatusHandler#
                </iterate>
            </isNotEmpty>
            <isNotEmpty prepend="and" property="criteria.published">
                DSM.Published = #criteria.published,handler=pl.nask.crs.commons.dao.ibatis.handlers.NullableCharToBooleanHandler#
            </isNotEmpty>
        </dynamic>
    </sql>

    <select id="findDsmStates" parameterClass="java.util.Map" resultMap="plain-domain.dsmState">
        SELECT
        DSM.State as dsmStateId,
        DSM.D_Holder_Type as dsmHolderType,
        DSM.Renewal_Mode as dsmRenewalMode,
        DSM.Locked as dsmLocked,
        DSM.Cust_Type as dsmCustomerType,
        DSM.NRP_Status as dsmNrpStatus,
        DSM.Secondary_Market_Status as dsmSecondaryMarketStatus,
        DSM.Published as dsmPublished
        FROM DSM_State AS DSM
        <include refid="dsm-test.dsmCriteria" />
    </select>

</sqlMap>